<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/global-variable/global-variable.html">

<dom-module id="polymer-theme-router">
    <template>
        <style>
            :host {
                display: none;
            }
        </style>
        <global-variable key="siteUrl" value="{{ siteUrl }}"></global-variable>
        <global-variable key="offline" value="{{ offline }}"></global-variable>

        <iron-ajax id="ajax"
                   loading="[[ loading ]]"
                   handle-as="json"
                   on-response="handleResponse"></iron-ajax>

    </template>
    <script>
        Polymer({
            is: 'polymer-theme-router',
            properties: {
                route: String,
                endPoint: {
                    type: String,
                    value: '/wp-json/polymer-theme/v1/search'
                },

                loading: Boolean,

                _url: {
                    type: String,
                    computed: '_mountUrl(siteUrl, endPoint)'
                },

                _params: {
                    type: Object,
                    computed: '_mountParams(siteUrl, route)'
                }
            },

            observers: [
                '_makeRequest(_url, _params)'
            ],

            handleResponse: function (event) {
                this.fire('found-next', {
                   item: event.detail.response[0]
                });
            },

            _mountParams: function (siteUrl, route) {
                return {
                    url: siteUrl + route.path
                }
            },

            _mountUrl: function(siteUrl, endPoint){
                return siteUrl + endPoint;
            },

            _makeRequest: function(_url, _params){
                if(!this.offline){
                    this.$.ajax.url = _url;
                    this.$.ajax.params = _params;
                    this.$.ajax.generateRequest();
                }
            },

        });
    </script>
</dom-module>