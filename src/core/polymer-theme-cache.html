<dom-module id="polymer-theme-cache">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        
    </template>
    <script>
        (function(){
            Polymer({
                is: 'polymer-theme-cache',
                properties: {
                    data: {
                        type: Object,
                        value: {},
                        notify: true,
                        observer: '_updateSW'
                    }
                },

                _updateSW: function(){
                    //SW operations here
                },

                _findIndex: function(taxonomy, slug){
                    var index, slugs, items = data[taxonomy];
                    
                    if(items){
                        slugs = items.map(function(x){
                            return x.slug;
                        })
                        index = slugs.indexOf(slug);
                    }

                    return (index) ? index: -1;
                    
                },

                _notify: function(action, data){
                    this.fire(action, {
                        action: action,
                        data: data
                    })
                },

                get: function(taxonomy, slug){
                    var index = _findIndex(taxonomy, slug);
                    return (index >= 0) ? this.data[taxonomy][0] : null; 
                },

                save: function(taxonomy, slug, item){
                    var index = _findIndex(taxonomy, slug);
                    if (index >= 0)
                        this.set('data.' + taxonomy + '.' + index, item);
                    else
                        this.push('data.' + taxonomy, item);

                    this._notify(taxonomy + '-saved', item);
                },

                remove: function(taxonomy, slug){
                    var item, index = _findIndex(taxonomy, slug);
                    
                    if(index >= 0){
                        item = this.data[taxonomy][index];
                        this.splice('data.' + taxonomy, index, 1);
                        this._notify(taxonomy + '-removed', item);
                    }
                },

                getAll: function(taxonomy){
                    return this.data[taxonomy] || [];
                },

                saveAll: function(taxonomy, items){
                    this.removeAll(taxonomy);
                    this.set('data.' + taxonomy, items);
                    this._notify('all-' + taxonomy + '-saved', items);
                },

                removeAll: function(taxonomy){
                    this.set('data.' + taxonomy, []);
                    this._notify('all-' + taxonomy + '-removed');
                }
            });
        })()
    </script>
</dom-module>
